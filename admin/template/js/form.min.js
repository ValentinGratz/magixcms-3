$(document).ready(function(){$.validator.setDefaults({debug:false,highlight:function(c,a,b){if($(c).parent().is("div")||$(c).parent().is("p")){if($(c).parent().hasClass("input-group")){$(c).parent().parent().addClass("has-error has-feedback")}else{if(!$(c).parent().hasClass("has-error")){$(c).parent().append('<span class="fa fa-warning form-control-feedback" aria-hidden="true"></span>')}$(c).parent().addClass("has-error has-feedback")}}else{if($(c).is('[type="radio"]')){$(c).parent().parent().addClass("has-error").parent().addClass("has-error")}}},unhighlight:function(c,a,b){if($(c).parent().is("div")||$(c).parent().is("p")){if($(c).parent().hasClass("input-group")){$(c).parent().parent().removeClass("has-error has-feedback")}else{if($(c).parent().hasClass("has-error")){$(c).next(".fa").remove()}$(c).parent().removeClass("has-error has-feedback")}}else{if($(c).is('[type="radio"]')){$(c).parent().parent().removeClass("has-error").parent().removeClass("has-error")}}},errorPlacement:function(a,b){if(b.is(":radio")){b.parent().parent().parent().append(a)}else{if(b.is(":checkbox")){a.insertAfter(b)}else{if(b.is("select")){a.insertAfter(b)}else{if(b.is(".checkMail")){a.insertAfter(b.next())}else{if(b.is("#cryptpass")){a.insertAfter(b.next());$("<br />").insertBefore(a)}else{if(b.next().is(":button")||b.next().is(":file")){a.insertAfter(b);$("<br />").insertBefore(a)}else{if(b.next().is(":submit")){a.insertAfter(b.next());$("<br />").insertBefore(a)}else{if($(b).parent().hasClass("input-group")){a.insertAfter(b.parent())}else{a.insertAfter(b)}}}}}}}}},errorClass:"help-block error",errorElement:"span",validClass:"success",success:function(a){a.remove()}});$(".date-input").formatter({pattern:"{{99}}/{{99}}/{{9999}}",persistent:false});$(".time-input").formatter({pattern:"{{99}}:{{99}}",persistent:false})});var globalForm=(function(f,c){function g(o,n){n=typeof n!=="undefined"?n:2800;setTimeout(function(){window.location.href=o},n)}function b(o,p){p=typeof p!=="undefined"?p:true;var n=f(document.createElement("div")).addClass("loader pull-right").append(f(document.createElement("i")).addClass("fa fa-spinner fa-pulse fa-2x fa-fw"),f(document.createElement("span")).append("Op√©ration en cours...").addClass("sr-only"));if(p){f(o).collapse()}f('button[type="submit"]').parent().empty().append(n)}function j(n,o){o=typeof o!=="undefined"?o:true;if(o){f(n).collapse("hide")}f(".loader").parent().empty()}function h(n,p,o){o=typeof o!=="undefined"?o:false;p=typeof p!=="undefined"?p:false;if(o){f.jmRequest.notifier={cssClass:".mc-message-"+o}}f.jmRequest.initbox(n,{display:true});if(p){window.setTimeout(function(){f(".mc-message .alert").alert("close")},p)}}function i(q,n,p){var o={handler:"submit",url:f(q).attr("action"),method:"post",form:f(q),resetForm:false,success:function(r){if(r.debug!=c&&r.debug!=""){h(r.debug)}else{if(r.notify!=c&&r.notify!=""){h(r.notify,4000)}}}};if(f(q).hasClass("add_form")){o.beforeParams=function(){b(q)};o.successParams=function(r){j(q);f.jmRequest.initbox(r.notify,{display:true});g(n);d()}}else{if(f(q).hasClass("add_modal_form")){o.success=function(t){h(t.notify,4000);f("#add_modal").modal("hide");if(t.statut&&t.result){n=n.substr(1,(n.indexOf(".")-1));var s="#table-"+n;var r=f(s).find("tbody").find("tr").length;if(!r){f(s).removeClass("hide").next(".no-entry").addClass("hide")}f(s).find("tbody").prepend(t.result);d()}}}else{if(f(q).hasClass("add_to_list")){o.resetForm=true;o.success=function(s){p=f(q).data("sub")==""?false:f(q).data("sub");h(s.notify,4000,p);if(s.statut&&s.result){var r=f(q).next().find("table");f(r).children("tbody").prepend(s.result).find("a.targetblank").off().on("click",function(){window.open(f(this).attr("href"));return false})}e(n,".edit_in_list");d()}}else{if(f(q).hasClass("edit_in_list")){o.success=function(r){f.jmRequest.initbox(r.notify,{display:false});if(r.statut){f('[type="submit"]',q).hide();f(".text-success",q).removeClass("hide");window.setTimeout(function(){f(".text-success",q).addClass("hide");f('[type="submit"]',q).show()},3000)}}}else{if(f(q).hasClass("delete_form")){o.resetForm=true;n=p?p:n.substr(1,(n.indexOf(".")-1));o.success=function(u){f("#delete_modal").modal("hide");f.jmRequest.notifier.cssClass=".mc-message-"+n;h(u.notify,4000);if(u.statut&&u.result){var t=u.result.id.split(",");var s=0;for(var r=0;r<t.length;r++){f("#"+n+"_"+t[r]).next(".collapse").remove();f("#"+n+"_"+t[r]).remove();s=f("#table-"+n).find("tbody").find("tr").length}if(!s){f("#table-"+n).addClass("hide").next(".no-entry").removeClass("hide")}f(".nbr-"+n).text(s);d()}}}}}}}f.jmRequest(o)}function e(n,p,o){p=typeof p!=="undefined"?p:".validate_form";o=typeof o!=="undefined"?o:false;f(p).each(function(){f(this).removeData();f(this).off();f(this).validate({ignore:[],onsubmit:true,event:"submit",submitHandler:function(q,r){r.preventDefault();i(q,n,o);return false}})})}function m(p,q,n,o){f(p+' input[type="hidden"]').val(q);f(p).modal("show");n="/"+n+".php";f(p).find("form").attr("action",n+"?action=delete"+(o?"&tabs="+o:""));e(n,"#delete_form",o)}function d(){var n=f(".modal");if(n.length){n.modal({show:false});f(".modal_action").each(function(){f(this).off().on("click",function(t){t.preventDefault();var s=f(this).data("target"),o=f(this).data("controller"),r=f(this).data("sub")?f(this).data("sub"):false,u=false;if(f(this).hasClass("action_on_record")){u=f(this).data("id")?f(this).data("id"):false}else{var q=f("#table-"+(r?r:o)).find('input[type="checkbox"]:checked');if(q.length){var p=f.map(q,function(w){return f(w).val()});u=p.join()}}if(s&&u&&o){m(s,u,o,r)}else{f("#error_modal").modal("show")}})})}}function l(n){if(!f(n).data("fstt")){f(n).on("hidden.bs.collapse",function(){f(this).off("hidden.bs.collapse");f(this).collapse("show").data({opened:false,closed:true}).on("hidden.bs.collapse",function(){f(this).data({opened:false,closed:true})})})}else{f(n).collapse("show")}}function k(q,s,o){if(q!=null&&q.length>0){if(s.indexOf("|")===-1&&!Array.isArray(q)){var p=f(s),t=p.children(".default");p.empty();if(t!=null&&t!=c){var r=t.clone();p.append(r)}p.append(q)}else{s=s.split("|");for(var u=0;u<s.length;u++){var p=f(s[u]),t=p.children(".default");p.empty();if(t!=null&&t!=c){var r=t.clone();p.append(r)}if(Array.isArray(q)){p.append(q[u])}else{p.append(q)}}}if(o.indexOf("|")===-1){l(o)}else{o=o.split("|");for(var n=0;n<o.length;n++){l(o[n])}}}}function a(n){f(".additional-fields").collapse({toggle:false}).data({fstt:true,opened:false,closed:true}).on("shown.bs.collapse",function(){f(this).data({opened:true,closed:false})}).on("hidden.bs.collapse",function(){f(this).data({opened:false,closed:true})}).each(function(){if(f(this).hasClass("in")){f(this).data({fstt:true,opened:true,closed:false})}});f(".has-optional-fields").each(function(){var o=f(this);var q=o.find(":selected");var r=f(this).find(".optional-field");var p=[];r.each(function(){if(f(this).data("target")&&p.indexOf(f(this).data("target"))===-1){p=p.concat(f(this).data("target").split("|"))}});f(this).off("change");f(this).on("change",function(){var C=q!=o.find(":selected");q=o.find(":selected");if(q.length&&C){for(var u=0;u<p.length;u++){if(f(p[u]).data("closed")){f(p[u]).data("fstt",true)}else{f(p[u]).collapse("hide");f(p[u]).data("fstt",false)}}if(q.hasClass("optional-field")){var x=q.data("target");var w=q.data("get");if(w!=c&&w!=null){w=w.split("|");var A=q.data("appendto"),t=q.data("id"),y=[],s=[];for(var z=0;z<w.length;z++){s.push(v(n,w[z],t,y))}f.when.apply(f,s).done(function(){k(y,A,x)});function v(E,F,H,G){var D=f.Deferred();f.jmRequest({handler:"ajax",url:E+"?action=get&content="+F+"&id="+H,method:"get",success:function(I){G.push(I);D.resolve()}});return D.promise()}}else{if(x.indexOf("|")===-1){l(x)}else{x=x.split("|");for(var B=0;B<x.length;B++){l(x[B])}}}}}})})}return{run:function(n){f.gForms=globalForm;e(n);d();a(n)},initModals:function(){d()}}})(jQuery);